<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="style.css">
    <title></title>
</head>
<body>

    <style src="mystyle.css"></style>
    <section>
        <div class="row">
            <div class="col">
                <div class="buttonHolder">
                    <input id="inputname" type="text" placeholder="Username">
                    <input onclick="findData()" id="submitname" type="button" value="Submit">
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col">
                <div><b>User Profile</b></div><br />
                <div class="profileElement">
                    <div><img id="user_avatar" /></div>
                    <div id="name" style="font-weight: bold; padding: 10px;">Name</div>
                    <div id="username" style="font-weight: bold; padding: 10px;">Username</div>
                    <div id="email" style="font-weight: bold; padding: 10px;">Email</div>
                    <div id="location" style="font-weight: bold; padding: 10px;">Location</div>
                    <div id="gistnum" style="font-weight: bold; padding: 10px;">Number of Gists</div>
                </div>
            </div>

            <div class="col">
                <div><b>User Repos</b></div><br />
                <div class="userRepo">
                    <label> Name</label><br />
                    <label> Description</label><br />
                </div>
            </div>
        </div>
    </section>

    <script>

        function fetch(url, options) {
            // ensure options is not undefined. Set it to an empty array if it is.
            options = options || {};
            return new Promise(function (resolve, reject) {
                // Check if our http method is specified. Is so use the specified one. If not use GET by default.
                var httpMethod = options.hasOwnProperty('method') ? options.method : 'GET';
                try {
                    var xhr = new XMLHttpRequest();
                    xhr.onreadystatechange = function () {
                        if (xhr.readyState == XMLHttpRequest.DONE) {
                            // Finished getting our request and 200 indicates a successful result
                            if (xhr.status == 200) {
                                resolve(xhr.response);
                            } else {
                                // Otherwise we are finished and did not get a successful result.
                                reject("Http Request Error: " + xhr.statusText);
                            }
                        }
                    }
                    // Check if we have any headers specified and assign them to the request header.
                    if (options.hasOwnProperty("header")) {
                        for (var index in options.header) {
                            xhr.setRequestHeader(index, options.header);
                        }
                    }

                    xhr.open(httpMethod, url, true);
                    xhr.send();
                } catch (e) {
                    reject("Failed to make request: " + e);
                }
            });
        };

        function getInput() {
            var getUser = document.getElementById('inputname').value;

            // Check if user has entered an input into the search
            if (getUser == null || getUser == "") {
                console.log("please enter a username");
            }
            return getUser;
        }

        function parseUserArray() {

            var input = getInput();

            var fetchURL = 'https://api.github.com/users/' + input;
            console.log(fetchURL);
            fetch(fetchURL).then(function (result) {

                var json;
                // Parse the json and do some error checking to ensure it is valid JSON.
                try {
                    json = JSON.parse(result);
                } catch (e) {
                    console.log("Could not parse JSON. Result: " + result);
                    return;
                }

                var userIds = [];

                console.log(json);

                var setAvatar = document.getElementById('user_avatar');
                setAvatar.setAttribute("src", json.avatar_url);

                var setName = document.getElementById('name');
                setName.innerHTML = "Name: " + json.name;

                var setUsername = document.getElementById('username');
                setUsername.innerHTML = "Username: " + json.login;

                var setEmail = document.getElementById('email');
                setEmail.innerHTML = "Email: " + json.email;

                var setLocation = document.getElementById('location');
                setLocation.innerHTML = "Location: " + json.location;

                var setGitNum = document.getElementById('gistnum');
                setGitNum.innerHTML = "Gist Number: " + json.public_gists;

                console.log(userIds);
            });
        }

        function findData()
        {
            parseUserArray();
            parseReposArray();
        }

        function parseReposArray() {
            var input = getInput();

            var fetchURL = 'https://api.github.com/users/' + input + '/repos';
            
            fetch(fetchURL).then(function (result) {

                var json;
                // Parse the json and do some error checking to ensure it is valid JSON.
                try {
                    json = JSON.parse(result);
                } catch (e) {
                    console.log("Could not parse JSON. Result: " + result);
                    return;
                }
            });
        }

        (function () {
            parseUserArray();
            //failedRequest();
        })();

    </script>

</body>
</html>